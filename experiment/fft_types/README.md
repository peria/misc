# FFT 実装系による速度差の測定

一口に FFT と言っても Stockham(Self-sorting) / Cooley-Tukey(in-place)、時間間引き(DIT)/周波数間引き(DIF)、など実装方法にはバリエーションがある。
ひとまずその大まかな時間差を計測するコード類を書いているつもりである。

実験内容としては n 個の複素数に FFT と逆 FFT をかける作業を繰り返す。10^7 回、もしくは 2 秒を超えた時点で止めて FLOPS 計算している。FLOPS 算出が正しいのかは少し疑問だが、とりあえずルーチン同士の比較にはなると思う。

## 比較対象

- `PMP` : 独自多倍長計算の中で使っている FFT から流用したもの。畳み込みへの応用しか想定しないので out-of-order の in-place FFT である。
- `Cooley-Tukey` : in-order の in-place FFT。 PMP から派生させて再配列するようにしている。in-order なので順変換と逆変換でルーチンの共有ができてメンテナンスコストが低い。
- `Stockham-DIX` : self-sorting FFT。DIT (時間間引き) と DIF (周波数間引き) で作ってみた。
- `PMP2` : データ列に padding を入れて cache conflict を避けられるか実験。PMP の派生。
- `PMP5` : out-of-order のまま 6 step FFT の最後の転置以外を実装してみた実験。
- `Stockham6` : StockDIT を　6 step FFT 化してみた。

## 実験

実験内容としては n 個の複素数に FFT と逆 FFT をかける作業を繰り返す。10^7 回、もしくは 2 秒を超えた時点の計算まで行い、MFLOPS を計算している。FLOPS 算出は [fft.h](fft.h) に書いている通り。往復計算なのでこれを 2 倍して時間で割っている。厳密には FLOPS 数が正確というわけではないが、とりあえずルーチン同士の速度比較にはなる。結果は以下の表の通り。

| #    |       PMP |      PMP2 |      PMP5 |    Cooley |  StockDIT |  StockDIF | Stockham6 |
|------|----------:|----------:|----------:|----------:|----------:|----------:|----------:|
| 2^ 2 |   970.043 |  1195.079 |  1250.000 |  1307.692 |  1330.724 |  1504.425 |  1261.596 |
| 2^ 3 |  2231.076 |  1721.311 |  2255.034 |  2382.979 |  2261.104 |  2222.222 |  2126.582 |
| 2^ 4 |  4861.483 |  3888.492 |  4722.222 |  4127.466 |  4641.638 |  4380.032 |  4440.816 |
| 2^ 5 |  4949.597 |  3752.552 |  4936.928 |  4322.273 |  4650.307 |  4512.280 |  4756.033 |
| 2^ 6 |  6166.236 |  4739.348 |  6371.144 |  4769.388 |  5976.139 |  6465.853 |  6801.076 |
| 2^ 7 |  6180.117 |  4424.059 |  6273.400 |  5429.885 |  5832.306 |  5718.194 |  5823.224 |
| 2^ 8 |  4674.509 |  4609.786 |  6868.701 |  5737.215 |  6824.980 |  6645.313 |  7179.129 |
| 2^ 9 |  6445.173 |  3878.111 |  6396.420 |  5475.779 |  6050.286 |  5705.939 |  6173.577 |
| 2^10 |  6605.466 |  4078.868 |  6773.496 |  5934.126 |  6718.792 |  6188.979 |  4439.606 |
| 2^11 |  6254.755 |  3816.229 |  6237.530 |  5437.083 |  5249.434 |  5042.646 |  4208.296 |
| 2^12 |  6573.957 |  3983.647 |  5676.122 |  4586.103 |  5356.929 |  5543.055 |  5066.355 |
| 2^13 |  6236.938 |  3915.399 |  6246.490 |  4805.460 |  5396.808 |  5243.109 |  4980.867 |
| 2^14 |  6741.074 |  3959.833 |  4585.685 |  4400.464 |  5650.219 |  5447.451 |  3788.259 |
| 2^15 |  5717.213 |  3812.819 |  4423.434 |  4622.942 |  5709.152 |  5640.634 |  4320.657 |
| 2^16 |  6592.247 |  4022.161 |  4674.814 |  4420.796 |  5165.023 |  6075.557 |  3959.802 |
| 2^17 |  6024.989 |  3759.886 |  4381.288 |  3403.940 |  5325.373 |  4952.046 |  3673.681 |
| 2^18 |  5263.679 |  3397.292 |  4349.547 |  4050.911 |  4240.849 |  3950.641 |  3718.890 |
| 2^19 |  4195.876 |  2909.029 |  4040.163 |  3282.681 |  3669.237 |  3479.176 |  3299.045 |
| 2^20 |  4196.361 |  3031.597 |  3648.814 |  3368.374 |  3761.085 |  3145.728 |  3322.119 |
| 2^21 |  3904.620 |  2873.263 |  3595.118 |  3040.870 |  3561.781 |  3185.393 |  3205.603 |
| 2^22 |  4218.916 |  3041.531 |  2962.549 |  3197.017 |  3303.235 |  3084.896 |  2679.524 |
| 2^23 |  3416.256 |  2522.195 |  2873.945 |  2707.603 |  3236.816 |  3008.872 |  2492.764 |


## 考察

概してどのサイズでも `PMP` を(優位に)上回る手法が出てきてない。高速化 Please
