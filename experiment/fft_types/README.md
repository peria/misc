# FFT 実装系による速度差の測定

一口に FFT と言っても Stockham(Self-sorting) / Cooley-Tukey(in-place)、時間間引き(DIT)/周波数間引き(DIF)、など実装方法にはバリエーションがある。
ひとまずその大まかな時間差を計測するコード類を書いているつもりである。

実験内容としては n 個の複素数に FFT と逆 FFT をかける作業を繰り返す。10^7 回、もしくは 2 秒を超えた時点で止めて FLOPS 計算している。FLOPS 算出が正しいのかは少し疑問だが、とりあえずルーチン同士の比較にはなると思う。

## 比較対象

`PMP` は独自多倍長計算の中で使っている FFT から流用したもの。畳み込みへの応用しか想定しないので out-of-order の in-place FFT である。
`Cooley-Tukey` は in-order の in-place FFT である。in-order なので順変換と逆変換でルーチンの共有ができるためメンテナンスコストを大きく下げる。
`Stockham-DIX` は self-sorting FFT である。DIT (時間間引き) と DIF (周波数間引き) で作ってみた。データと同サイズの作業領域を確保する必要があるのでキャッシュギリギリの場合はパフォーマンス的に劣りやすい。

## 実験

実験内容としては n 個の複素数に FFT と逆 FFT をかける作業を繰り返す。10^7 回、もしくは 2 秒を超えた時点の計算まで行い、MFLOPS を計算している。FLOPS 算出は [fft.h] に書いている通り。往復計算なのでこれを 2 倍して時間で割っている。厳密には FLOPS 数が正確というわけではないが、とりあえずルーチン同士の速度比較にはなる。結果は以下の表の通り。


| #    |       PMP |    Cooley |  StockDIT |  StockDIF |
|------|----------:|----------:|----------:|----------:|
| 2^ 2 |  1563.218 |  1393.443 |  1662.592 |  1642.512 |
| 2^ 3 |  2580.645 |  2343.096 |  2234.043 |  2164.948 |
| 2^ 4 |  4701.815 |  4111.867 |  4575.273 |  3812.193 |
| 2^ 5 |  4951.923 |  4094.389 |  4759.634 |  4675.800 |
| 2^ 6 |  6574.081 |  5489.810 |  6401.571 |  6395.031 |
| 2^ 7 |  6158.515 |  5038.620 |  5435.003 |  5716.265 |
| 2^ 8 |  6876.909 |  5692.747 |  6666.994 |  6666.907 |
| 2^ 9 |  6426.593 |  5600.913 |  6312.112 |  5365.776 |
| 2^10 |  6062.075 |  5284.634 |  6600.069 |  6305.656 |
| 2^11 |  6417.068 |  5755.876 |  5369.460 |  5196.210 |
| 2^12 |  6777.004 |  4305.764 |  5904.445 |  5991.555 |
| 2^13 |  6449.250 |  4874.928 |  5661.655 |  5424.161 |
| 2^14 |  6601.671 |  4629.553 |  5981.667 |  5679.464 |
| 2^15 |  6293.570 |  4846.633 |  5753.487 |  5791.777 |
| 2^16 |  6528.696 |  4621.172 |  6382.899 |  6283.592 |
| 2^17 |  6037.176 |  4131.745 |  5444.529 |  5062.091 |
| 2^18 |  5311.658 |  3998.807 |  4318.711 |  4042.826 |
| 2^19 |  4191.686 |  3199.019 |  3601.971 |  3164.312 |
| 2^20 |  4407.960 |  3416.245 |  3743.416 |  3572.128 |
| 2^21 |  3883.840 |  3008.427 |  3368.894 |  3262.931 |
| 2^22 |  4254.282 |  3185.475 |  3616.113 |  3445.102 |
| 2^23 |  3928.946 |  2755.330 |  3226.388 |  3196.457 |

## 考察

速度比較としては `Cooley-Tukey` ＜ `Stockham` ＜ `PMP` という感じである。Cooley-Tukey FFT での並べ替えによる速度低下は無視できない。
