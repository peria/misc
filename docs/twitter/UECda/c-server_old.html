<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
            "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja">
<HEAD>
 <meta http-equiv="Content-Type" content="text/html; charset=EUC-JP">
 <META http-equiv="Content-Style-Type" content="text/css">
 <LINK REV="MADE" HREF="mailto:tnlab-webmaster@ice.uec.ac.jp"> 
 <LINK rel="INDEX" href="./index.html">
 <link href="ver01.css" rel="stylesheet" type="text/css"> 
 <TITLE>サーバープログラムについて（C言語版）</TITLE>
</HEAD>
<BODY>
<p>
<a href="c-client.html">[前のページ]</a>
<a href="manual.html">[目次]</a>
<a href="j-pref.html">[次のページ]</a>
</p>
<hr>

<h1>8. サーバープログラムについて（C言語版）</h1>
<div class="text">
<p>
本章では、サーバープログラムの役割と使用方法を説明します。
</p>
</div>

<hr class="middle">
<h2><a name="8.1role">8.1 サーバープログラムの役割</a></h2>
<div class="text">
<p>
クライアントプログラムがカードの出し方を決定するのに対して、サーバープログラムは、場の管理を行います。具体的には、次のようなことを管理します。
</p>
<ul>
<li> プロトコルバージョンの管理
<li> それぞれのプレイヤー（クライアント）の持っているカードの管理
<li> 各プレイヤーへのカードの配布
<li> 各プレイヤーから出されたカードのが、正当な物かの判定。
<li> 場に出ているカードの管理
<li> 場の状況（革命中か否か・縛り中か否か等）等の管理
<li> 画面線画
</ul>

<p>
サーバープログラムは、クライアントからの接続を待ち、接続してきたクライアントにプレイヤー番号を割り振ります。プレイヤーの人数が 5人になったらゲームが始まります。
</p>

<p>
1ゲーム終了までの流れと、その中におけるサーバーの役割は、次のようになります。クライアントとの通信を伴うパートには、行末に「通信」と書いてあります。
</p>

<ol>
  <li> サーバーの内部で、各プレイヤーに渡すカードを決定する。
  <li> 平民・貧民・大貧民にカードを通知する。
  <li> 大貧民から、強いカードを2枚取り、大富豪に渡すカードに追加する。
  <li> 大富豪にカードを提示し、大貧民に渡すカードを 2枚受け取る。（通信）
  <li> 貧民から、強いカードを1枚取り、富豪に渡すカードに追加する。
  <li> 富豪にカードを提示し、貧民に渡すカードを 1枚受け取る。（通信）
  <li> 4人のカードが無くなるまで、次を繰り返す。
    <ol>
      <li>各プレイヤーに対して、持ち札を通知する。（通信）
      <li>順番が回ってきたクライアントにターンを回す。（通信）
      <li>順番が回ってきているクライアントからカードを受け取る。（通信）
      <li>順番が回ってきているクライアントから貰ったカードが正当か否かを判定する。
      <li>順番が回ってきているクライアントに、受理・非受理の結果を通知する。（通信）
      <li>特殊効果を持っているカードだった場合、その処理を行う。
      <li>場の状況等を更新する。
      <li>次にカードを出すプレイヤーが誰かを判定する。
      <li>場のカードと状況を、各クライアントに通知する。（通信）
      <li>ゲームが続行する場合、各クライアントにゲームが続行することを通知する。（通信）
    </ol>
  <li> 1ゲームが終了したことを各クライアントに通知し、次のゲームに移る。（通信）
</ol>

<p>
配布キット中に含まれているサンプルクライアントプログラムをベースに開
発を行なう場合には、上記の流れを意識する必要は、特にないでしょう。
</p>
</div>


<hr class="middle">
<h2>8.2 インストール方法</h2>
<div class="text">
<p>
configure スクリプトを利用する方法や xmkmf を使用する方法があります。詳しくは、ソースに付属している INSTALL.txt を読んで下さい。
</p>
</div>

<hr class="middle">
<h2>8.3 使用方法</h2>
<div class="text">

<p>
コンパイル後、src ディレクトリに移動し、tndhms を実行して下さい。
</p>

<p>
ゲーム中は、次の画面が表示されます。
</p>
<p>
<img src="img/server.png" width=717 height=556 alt="tndhms の実行画面">
</p>

<p>
画面の各部分の意味は、以下の通りです。
</p>
<ol>
  <li> 現在、場に出ているカードが表示されます。
  <li> 通常は緑色ですが、革命が起きるとオレンジ色になります。
  <li> 現在のゲームで「縛り」が行われているとき、ここに表示されます。
  <li> 各プレイヤーの持っているカードの一覧です。
  <li> 各プレイヤーがパスを行ったか否かを表示します。また、現在ターンが回っているプレイヤーを表示します。
  <li> 各プレイヤーの現在の身分です。
  <li> 操作窓です。サーバーの動作速度や画面表示を切り替えます。
    <ul>
      <li>一番上の四角をクリックした場合は、自動実行高速モードに切り替わります。      <li>二番上の四角をクリックした場合は、自動実行低速モードに切り替わります。      <li>三番目の四角をクリックした場合、ステップ実行モードに切り替わります。このモードの際は、この四角をクリックする毎に、1ステップずつ進みます。
      <li>四番目の四角をクリックした場合、グラフ表示モードに切り替わります。
          各プレイヤーの得点推移がグラフによって表示されます。
   </ul>
</ol>
</div>

<hr>
<p>
<a href="c-client.html">[前のページ]</a>
<a href="manual.html">[目次]</a>
<a href="j-pref.html">[次のページ]</a>
</p>
<hr>
<p>
<a href="../../index.html">[UECda]</a> →
<a href="../index.html">[UECda-2010]</a> → 
<a href="manual.html">[マニュアル目次]</a> →
[サーバープログラムについて]
</p>
</body>
</html>

